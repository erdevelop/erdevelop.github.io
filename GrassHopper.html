<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Mini Grasshopper - Matematik Node’ları</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; background:#eef0f3; }
  #toolbar { background:#333; color:white; padding:10px; }
  #toolbar button { margin-right:8px; padding:6px 10px; border:none; border-radius:6px; cursor:pointer; background:#555; color:white; }
  #canvas { position:relative; width:100vw; height:calc(100vh - 40px); }
  svg { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
  .node { position:absolute; background:#fff; border:2px solid #aaa; border-radius:10px; padding:8px; width:160px; box-shadow:2px 2px 6px rgba(0,0,0,0.15); cursor:grab; }
  .node h3 { margin:0 0 5px 0; font-size:13px; }
  .socket { width:14px; height:14px; border-radius:50%; display:inline-block; vertical-align:middle; cursor:crosshair; }
  .in { background:#ff9933; }
  .out { background:#0099cc; }
  .result { font-weight:bold; color:#007700; }
  input[type=number]{width:50px;margin-left:5px;}
</style>
</head>
<body>
<div id="toolbar">
  <button id="addNumber">+ Number</button>
  <button id="addAdd">+ Add</button>
  <button id="addMultiply">× Multiply</button>
  <button id="addSubtract">− Subtract</button>
  <button id="addDivide">÷ Divide</button>
</div>
<div id="canvas">
  <svg id="wires"></svg>
</div>

<script>
const canvas=document.getElementById('canvas');
const svg=document.getElementById('wires');
const connections=[];
let nodeCount=0;
let activeWire=null;

// --- Node oluşturma ---
function createNode(type,x=100,y=100){
  const node=document.createElement('div');
  node.className='node';
  node.style.left=x+'px';
  node.style.top=y+'px';
  node.dataset.id='node'+(++nodeCount);
  node.dataset.type=type;

  if(type==='number'){
    node.innerHTML=`<h3>Number</h3>
      <span class="out socket" data-id="${node.dataset.id}-out"></span>
      <input type="number" value="0">`;
  }else if(type==='add'||type==='multiply'||type==='subtract'||type==='divide'){
    const opSymbol = type==='add'?'+': type==='multiply'?'×': type==='subtract'?'-':'÷';
    node.innerHTML=`<h3>${opSymbol} ${type.charAt(0).toUpperCase()+type.slice(1)}</h3>
      <div>A <span class="in socket" data-id="${node.dataset.id}-inA"></span></div>
      <div>B <span class="in socket" data-id="${node.dataset.id}-inB"></span></div>
      <div>Sonuç: <span class="result">0</span></div>`;
  }

  canvas.appendChild(node);
  makeDraggable(node);
  setupSockets(node);
}

// --- Sürükleme ---
function makeDraggable(el){
  let isDown=false,offsetX,offsetY;
  el.addEventListener('mousedown',e=>{
    if(e.target.classList.contains('socket')) return;
    isDown=true;
    offsetX=e.clientX-el.offsetLeft;
    offsetY=e.clientY-el.offsetTop;
    el.style.cursor='grabbing';
  });
  document.addEventListener('mouseup',()=>{isDown=false;el.style.cursor='grab';});
  document.addEventListener('mousemove',e=>{
    if(!isDown) return;
    el.style.left=(e.clientX-offsetX)+'px';
    el.style.top=(e.clientY-offsetY)+'px';
    updateWires();
  });
}

// --- Socket sistemi ---
function setupSockets(node){
  node.querySelectorAll('.socket.out').forEach(out=>{
    out.addEventListener('mousedown',e=>{
      activeWire={out:out.dataset.id};
    });
  });
  node.querySelectorAll('.socket.in').forEach(inp=>{
    inp.addEventListener('mouseup',e=>{
      if(activeWire){
        activeWire.in=inp.dataset.id;
        connections.push(activeWire);
        activeWire=null;
        updateWires();
        calculate();
      }
    });
  });
  const input=node.querySelector('input[type="number"]');
  if(input) input.addEventListener('input',calculate);
}

// --- Wire çizimi ---
function createWirePath(x1,y1,x2,y2){
  const d=`M${x1},${y1} C${x1+50},${y1} ${x2-50},${y2} ${x2},${y2}`;
  const path=document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("d",d);
  path.setAttribute("stroke","#333");
  path.setAttribute("stroke-width","2");
  path.setAttribute("fill","none");
  return path;
}
function updateWires(){
  svg.innerHTML='';
  connections.forEach(conn=>{
    const outEl=document.querySelector(`[data-id='${conn.out}']`);
    const inEl=document.querySelector(`[data-id='${conn.in}']`);
    if(!outEl||!inEl) return;
    const outRect=outEl.getBoundingClientRect();
    const inRect=inEl.getBoundingClientRect();
    const x1=outRect.left+7,y1=outRect.top+7;
    const x2=inRect.left+7,y2=inRect.top+7;
    svg.appendChild(createWirePath(x1,y1,x2,y2));
  });
}

// --- Hesaplama ---
function calculate(){
  const values={};
  document.querySelectorAll('.node[data-type="number"]').forEach(node=>{
    const val=Number(node.querySelector('input').value);
    values[node.dataset.id+'-out']=val;
  });

  document.querySelectorAll('.node[data-type="add"],.node[data-type="multiply"],.node[data-type="subtract"],.node[data-type="divide"]').forEach(node=>{
    const aIn=node.dataset.id+'-inA';
    const bIn=node.dataset.id+'-inB';
    let aVal=0,bVal=0;

    connections.forEach(conn=>{
      if(conn.in===aIn && values[conn.out]!==undefined) aVal=values[conn.out];
      if(conn.in===bIn && values[conn.out]!==undefined) bVal=values[conn.out];
    });

    let result=0;
    if(node.dataset.type==='add') result=aVal+bVal;
    else if(node.dataset.type==='multiply') result=aVal*bVal;
    else if(node.dataset.type==='subtract') result=aVal-bVal;
    else if(node.dataset.type==='divide') result=bVal!==0?aVal/bVal:'∞';

    node.querySelector('.result').textContent=result;
    values[node.dataset.id+'-out']=result;
  });
}

// --- Toolbar butonları ---
document.getElementById('addNumber').onclick=()=>createNode('number',100,100+Math.random()*200);
document.getElementById('addAdd').onclick=()=>createNode('add',400,150+Math.random()*200);
document.getElementById('addMultiply').onclick=()=>createNode('multiply',400,150+Math.random()*200);
document.getElementById('addSubtract').onclick=()=>createNode('subtract',400,150+Math.random()*200);
document.getElementById('addDivide').onclick=()=>createNode('divide',400,150+Math.random()*200);

// Başlangıç için 1 Number + 1 Add
createNode('number',100,100);
createNode('add',400,150);
</script>
</body>
</html>
